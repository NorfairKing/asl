\documentclass[11pt]{article}
\usepackage[a4paper, portrait, margin=1in]{geometry}

\usepackage{mathtools}
\usepackage{float}

\input{../common.tex}

\begin{document}

\title{Advanced Systems Lab (Fall'16) -- Second
Milestone}

\author{Name: \emph{\myname}\\Legi number: \emph{\myleginr}}

\date{
\vspace{4cm}
\textbf{Grading} \\
\begin{tabular}{|c|c|}
\hline  \textbf{Section} & \textbf{Points} \\ 
\hline  1 &  \\ 
\hline  2 &  \\ 
\hline  3 &  \\ 
\hline \hline Total & \\
\hline 
\end{tabular} 
}

\maketitle

\newpage

\section{Maximum Throughput}
% Find the highest throughput of your system for 5 servers with no replication and a read-only workload configuration. What is the minimum number of threads and clients (rounded to multiple of 10) that together achieve this throughput? Explain why the system reaches its maximum throughput at these points and show how the performance changes around these configurations. Provide a detailed breakdown of the time spent in the middleware for each operation type.

The first experiment is the maximum throughput experiment.
The details of this experiment can be found in figure \ref{fig:maximum-throughput-experiment}.

\begin{figure}
  \centering
  \input{\genfile{remote-maximum-throughput-table.tex}}
  \caption{Maximum throughput experiments}
\end{figure}

\begin{figure}
  \centering
  \input{\genfile{big-remote-maximum-throughput-table.tex}}
  \caption{Big Maximum throughput experiments}
\end{figure}


Figure \ref{fig:maximum-throughput-throughput} shows that throughput tends to increase as the number of clients increases.
It also shows that an increase in the number of clients has diminishisng effects past \FIWRD clients.
Past this point, the average total throughput levels off at about \FIWRD transactions per second.

\TODO{Mention the effect of the number of threads}

\begin{figure}
  \centering
    \includegraphics[width=0.32\textwidth]{\plot{local-maximum-throughput-maximum-throughput-1.png}}
    \includegraphics[width=0.32\textwidth]{\plot{local-maximum-throughput-maximum-throughput-2.png}}
    \includegraphics[width=0.32\textwidth]{\plot{local-maximum-throughput-maximum-throughput-3.png}}
    \includegraphics[width=0.32\textwidth]{\plot{local-maximum-throughput-maximum-throughput-4.png}}
    \includegraphics[width=0.32\textwidth]{\plot{local-maximum-throughput-maximum-throughput-5.png}}
    \includegraphics[width=0.32\textwidth]{\plot{local-maximum-throughput-maximum-throughput-6.png}}
  \caption{Maximum Throughput}
\end{figure}
\begin{figure}
  \centering
    \includegraphics[width=0.32\textwidth]{\plot{big-local-maximum-throughput-maximum-throughput-1.png}}
    \includegraphics[width=0.32\textwidth]{\plot{big-local-maximum-throughput-maximum-throughput-6.png}}
    \includegraphics[width=0.32\textwidth]{\plot{big-local-maximum-throughput-maximum-throughput-11.png}}
    \includegraphics[width=0.32\textwidth]{\plot{big-local-maximum-throughput-maximum-throughput-16.png}}
    \includegraphics[width=0.32\textwidth]{\plot{big-local-maximum-throughput-maximum-throughput-21.png}}
    \includegraphics[width=0.32\textwidth]{\plot{big-local-maximum-throughput-maximum-throughput-26.png}}
  \caption{Big Maximum Throughput}
\end{figure}

Figure \ref{fig:maximum-throughput-trace-slice-1-thread-absolute} and \ref{fig:maximum-throughput-trace-slice-1-thread-relative} show a detailed breakdown of where each requests spends time in the middleware.
Figure \ref{fig:maximum-throughput-trace-slice-1-thread-absolute} shows the average absolute time spent in the middleware for a request.
Figure \ref{fig:maximum-throughput-trace-slice-1-thread-relative} shows the same data, but the time is shown in percentages relative to the total average amount of time spent per request.

Figure \ref{fig:maximum-throughput-trace-slice-1-thread-absolute} shows that, as the number of clients increases, the only part that takes significantly longer is the time that an average requests spends in the queue, waiting to be forwarded to a server.
Figure \ref{fig:maximum-throughput-trace-slice-1-thread-relative} shows that, as the number of clients increases, the time that an average request spends on the queue becomes the most significant component of the total time spent in the middleware.
In fact, it becomes more than ten \FIWRD times more significant than any other part of the waiting time.

Figure TODO shows that the situation is similar when the middleware uses six \FIWRD threads per read pool.
The total time spent in the middleware is lower for an average request, but essentially the same problem occurs.
The average request spends the majority of its time in the middleware on a queue waiting to be forwarded to a server, and this part of the time spent becomes increasingly significant as the number of clients increases, just like before.

\begin{figure}
  \centering
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-absolute-1-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-relative-1-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-absolute-2-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-relative-2-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-absolute-3-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-relative-3-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-absolute-4-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-relative-4-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-absolute-5-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-relative-5-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-absolute-6-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-maximum-throughput-slice-relative-6-slice.png}}
  \caption{Big Maximum Throughput Trace Slice}
\end{figure}

\begin{figure}
  \centering
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-absolute-1-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-relative-1-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-absolute-6-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-relative-6-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-absolute-11-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-relative-11-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-absolute-16-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-relative-16-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-absolute-21-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-relative-21-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-absolute-26-slice.png}}
    \includegraphics[width=0.48\textwidth]{\plot{big-local-maximum-throughput-slice-relative-26-slice.png}}
  \caption{Big Maximum Throughput Trace Slice}
\end{figure}


\section{Effect of Replication}

% Explore how the behavior of your system changes for a 5\%-write workload with S=3,5 and 7 server backends and the following three replication factors:
% \begin{itemize} 
% \item Write to $1$ (no replication) 
% \item Write to $\ceil{\frac{S}{2}}$ (half) 
% \item Write to all 
% \end{itemize}
% 
% Answer at least the following questions: Are \texttt{get} and \texttt{set} requests impacted the same way by different setups? If yes/no, why? Which operations become more expensive inside the middleware as the configuration changes? How does the scalability of your system compare to that of an ideal implementation? Provide the graphs and tables necessary to support your claims.

 

\begin{figure}
  \centering
  \input{\genfile{remote-replication-effect-table.tex}}
  \caption{Replication effect experiments}
  \label{fig:replication-effect-experiment}
\end{figure}

\begin{figure}
  \centering
    \includegraphics[width=0.31\textwidth]{\plot{local-replication-effect-replication-analysis-3.png}}
    \includegraphics[width=0.31\textwidth]{\plot{local-replication-effect-replication-analysis-5.png}}
    \includegraphics[width=0.31\textwidth]{\plot{local-replication-effect-replication-analysis-7.png}}
  \caption{Effect of replication factor}
  \label{fig:replication-analysis}
\end{figure}

\begin{figure}
  \centering
    \includegraphics[width=0.48\textwidth]{\plot{local-replication-effect-replication-cost-analysis-3-read.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-replication-effect-replication-cost-analysis-3-write.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-replication-effect-replication-cost-analysis-5-read.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-replication-effect-replication-cost-analysis-5-write.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-replication-effect-replication-cost-analysis-7-read.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-replication-effect-replication-cost-analysis-7-write.png}}
  \caption{Effect of replication factor}
  \label{fig:replication-analysis}
\end{figure}

\section{Effect of Writes}

% In this section, you should study the changes in throughput and response time of your system as the percentage of write operations increases. Use a combination of 3 to 7 servers and vary the number of writes between 1\% and 10\% (e.g. 1\%, 5\% and 10\%). The experiments need to be carried out for the replication factors R=1 and R=all.  
% 
% For what number of servers do you see the biggest impact (relative to base case) on performance? Investigate the main reason for the reduced performance and provide a detailed explanation of the behavior of the system. Provide the graphs and tables necessary to support your claims.

 
\begin{figure}
  \centering
  \input{\genfile{remote-write-effect-table.tex}}
  \caption{Write effect experiments}
  \label{fig:write-effect-experiment}
\end{figure}

\begin{figure}
  \centering
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-tps-3.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-tps-4.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-tps-5.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-tps-6.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-tps-7.png}}
  \caption{Effect of write percentage: Throughput}
  \label{fig:write-analysis-tps}
\end{figure}
\begin{figure}
  \centering
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-resp-3.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-resp-4.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-resp-5.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-resp-6.png}}
    \includegraphics[width=0.48\textwidth]{\plot{local-write-effect-write-analysis-resp-7.png}}
  \caption{Effect of write percentage: Response time}
  \label{fig:write-analysis-resp}
\end{figure}
 
\end{document}
