\documentclass[11pt]{article}
\usepackage[a4paper, portrait, margin=1in]{geometry}

\input{../common.tex}

\usepackage{float}
\usepackage{hyperref}
\usepackage{tikz}
\usetikzlibrary{shapes}
\usetikzlibrary{patterns}

\begin{document}

\title{Advanced Systems Lab (Fall'16) -- Third Milestone}

\author{Name: \emph{\myname}\\Legi number: \emph{\myleginr}}

\date{
\vspace{4cm}
\textbf{Grading} \\
\begin{tabular}{|c|c|}
\hline  \textbf{Section} & \textbf{Points} \\ 
\hline  1 &  \\ 
\hline  2 &  \\ 
\hline  3 &  \\ 
\hline  4 &  \\ 
\hline  5 &  \\ 
\hline \hline Total & \\
\hline 
\end{tabular} 
}

\maketitle
\newpage

\section{System as One Unit}\label{sec:system-one-unit}

% Length: 1-2 pages

% Build an M/M/1 model of your entire system based on the stability trace that you had to run for the first milestone. Explain the characteristics and behavior of the model built, and compare it with the experimental data (collected both outside and inside the middleware). Analyze the modeled and real-life behavior of the system (explain the similarities, the differences, and map them to aspects of the design or the experiments). Make sure to follow the model-related guidelines described in the Notes!

\begin{figure}[H]
  \centering
  \input{\genfile{remote-stability-trace-table.tex}}
  \caption{Stability trace}
  \label{fig:sut-stability-trace}
\end{figure}

\subsection{Boundaries of M/M/1 model}

To make a M/M/1 model of the entire system, we have to treat the system under test as a black box.
The black box is drawn from the clients, across the network, across the middleware, across the network and across the servers.

\begin{figure}[H]
  \centering
	
  \begin{tikzpicture}
    \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.5\textwidth]{\asset{architecture.png}}};
    \begin{scope}[x={(image.south east)},y={(image.north west)}]
			\draw (-0.7,0.5) circle (1cm) node (C) {Clients};
			\node (N) at (-0.3,0.5) [cloud, draw,cloud puffs=10,cloud puff arc=120, aspect=2, inner ysep=1em] {network};
			\draw [->, thick] (C) -- (N) -- (image);
    \end{scope}
  \end{tikzpicture}
  \caption{Complete view of the system}
  \label{ref:complete-system}
\end{figure}

\begin{figure}[H]
  \centering
  \begin{tikzpicture}
    \node[anchor=south west,inner sep=0, opacity=0.5] (image) at (0,0) {\includegraphics[width=0.5\textwidth]{\asset{architecture.png}}};
    \begin{scope}[x={(image.south east)},y={(image.north west)}]
			\draw (-0.7,0.5) circle (1cm) node (C) {Clients};
			\node (N) at (-0.3,0.5) [cloud, draw,cloud puffs=10,cloud puff arc=120, aspect=2, inner ysep=1em, opacity=0.5] {network};
			\draw [->, thick] (C) -- (N) -- (image);
			\draw [pattern=north west lines, pattern color=blue, fill=black, fill opacity=0.3, text opacity=1] (-0.55,0) rectangle (1.05,1.05);
    	\node[anchor=south west,inner sep=0] (image) at (-0.5,0.22) {\includegraphics[width=0.7\textwidth]{\asset{mm1.png}}};
    \end{scope}
  \end{tikzpicture}
  \caption{Black box system for M/M/1 model}
  \label{ref:mm1-black-box}
\end{figure}

\subsection{Parameter estimation}

Next we pretend that everything in this black box corresponds to a system as modeled by an M/M/1 model, and try to estimate the parameters $\lambda$ and $\mu$ of the M/M/1 model.
To justify the following estimation of the parameters, we rely on the fact that we are dealing with a closed system.

The arrival rate $\lambda$ is estimated by looking at the average throughput as seen by the clients.
Indeed, the rate at which requests arrive at the black box is exactly equal to the rate at which requests get processed (assuming the time it takes for a client to send the next request is negligible).

The service rate $\mu$ is estimated by asserting that the mean number of jobs in the system is equal to the total number of clients.
We know that the M/M/1 model with arrival rate $\lambda$ and service rate $\mu$ predicts a mean number of jobs of $\frac{1}{\mu (1 - \frac{\lambda}{\mu})}$.
From this knowledge, we can estimate the service rate as $\mu = \frac{(1 + v) * \lambda}{v}$ where $v$ is the total number of clients.

\begin{figure}[H]
  \centering
  \input{\model{remote-stability-trace-mm1.tex}}
\end{figure}

Traffic intensity is calculated from arrival rate and service rate in both collumns.

the rest of the measures are calculated from the model in the case of the model.

Mean response time, std dev response time are taken from the client.
Mean waiting time and std dev reps are taken from the middleware.

Mean number of jobs in the system is equal to the number of clients in total at the client.
Std dev number of jobs is set to 0 because in a closed system the number of jobs in the system is constant
and equal to the number of clients.

\section{Analysis of System Based on Scalability Data}\label{sec:analysis-scalability}

% Length: 1-4 pages

% Starting from the different configurations that you used in the second milestone, build M/M/m queuing models of the system as a whole. Detail the characteristics of these series of models and compare them with experimental data. The goal is the analysis of the model and the real scalability of the system (explain the similarities, the differences, and map them to aspects of the design or the experiments). Make sure to follow the model-related guidelines described in the Notes!

\section{System as Network of Queues}\label{sec:network-of-queues}

% Length: 1-3 pages

% Based on the outcome of the different modeling efforts from the previous sections, build a comprehensive network of queues model for the whole system. Compare it with experimental data and use the methods discussed in the lecture and the book to provide an in-depth analysis of the behavior. This includes the identification and analysis of bottlenecks in your system. Make sure to follow the model-related guidelines described in the Notes!

\section{Factorial Experiment}\label{sec:2k-experiment}

% Length: 1-3 pages

% Design a $2^k$ factorial experiment and follow the best practices outlined in the book and in the lecture to analyze the results. You are free to choose the parameters for the experiment and in case you have already collected data in the second milestone that can be used as source for this experiment, you can reuse it. Otherwise, in case you need to run new experiments anyway, we recommend exploring the impact of request size on the middleware together with an other parameter.

\section{Interactive Law Verification}\label{sec:interactive-law}

% Length: 1-2 pages

% Check the validity of all experiments from one of the three sections in your Milestone 2 report using the interactive law (choose a section in which your system has at least 9 different configurations). Analyze the results and explain them in detail.

We assume that the think time is negligible.
TODO: think time benchmark: 1 middleware, client and server, log every request, then think time is time between end of previous and start of next request.

TODO: Correct for the tail distribution?

\begin{figure}[H]
  \centering
  \input{\genfile{remote-replication-effect-irtl-table.tex}}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{\plot{total-duration-histos/remote-replication-effect-histogram-5.png}}
\end{figure}

\begin{figure}[H]
  \centering
  \input{\genfile{remote-think-time-table.tex}}
  \caption{Think time benchmark}
  \label{fig:sut-think-time}
\end{figure}


\section{Log file listing}

\input{\genfile{report-3-logfile-listings.tex}}

\end{document}
